â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    SOIL PARAMETER OPTIMIZATION FRAMEWORK - FILE INDEX
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“¦ FRAMEWORK OVERVIEW
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
A complete framework for optimizing van Genuchten soil hydraulic parameters
using PyTorch optimizers and automatic differentiation (finite differences or
adjoint method). Integrates seamlessly with your existing Firedrake Richards
equation solver.

ğŸ“„ DOCUMENTATION FILES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

1. QUICKSTART.md (START HERE!) â­
   â”œâ”€ Quick 3-step getting started guide
   â”œâ”€ Integration example with your code
   â”œâ”€ Common use cases and troubleshooting
   â””â”€ Typical van Genuchten parameter values

2. README.md (DETAILED GUIDE)
   â”œâ”€ Complete documentation
   â”œâ”€ All features and options explained
   â”œâ”€ Advanced usage examples
   â”œâ”€ Performance considerations
   â””â”€ Troubleshooting guide

3. ARCHITECTURE.txt (SYSTEM DESIGN)
   â”œâ”€ Visual architecture diagram
   â”œâ”€ Data flow explanation
   â”œâ”€ Comparison of approaches (finite diff vs adjoint)
   â””â”€ Performance characteristics

ğŸ’» CORE FRAMEWORK FILES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

4. parameter_optimizer.py (MAIN OPTIMIZER - Finite Differences)
   â”œâ”€ RichardsParameterOptimizer class
   â”œâ”€ ParameterBounds class
   â”œâ”€ ParameterVector (transformation handling)
   â”œâ”€ ObservationData container
   â””â”€ Uses: Simple, robust gradient computation
   
   Key Classes:
   â€¢ ParameterBounds: Define min/max for each parameter
   â€¢ ParameterVector: Handles parameter transformations
   â€¢ RichardsParameterOptimizer: Main optimization loop
   
   Use this when:
   âœ“ You have < 5 parameters to optimize
   âœ“ You want something simple and robust
   âœ“ Quick prototyping and testing

5. adjoint_optimizer.py (ADVANCED OPTIMIZER - Adjoint Method)
   â”œâ”€ AdjointParameterOptimizer class
   â”œâ”€ MultiObjectiveOptimizer class
   â”œâ”€ sensitivity_analysis() function
   â”œâ”€ uncertainty_quantification() function
   â””â”€ Uses: pyadjoint for efficient gradients
   
   Key Classes:
   â€¢ AdjointParameterOptimizer: Fast gradient computation
   â€¢ MultiObjectiveOptimizer: Handle multiple objectives
   
   Use this when:
   âœ“ You have many parameters (> 5)
   âœ“ You need many optimization iterations
   âœ“ You want uncertainty quantification
   âœ“ Production/final results

6. data_preparation.py (DATA UTILITIES)
   â”œâ”€ load_water_level_csv()
   â”œâ”€ prepare_observation_data()
   â”œâ”€ quality_check_observations()
   â”œâ”€ remove_outliers()
   â”œâ”€ add_observation_weights()
   â””â”€ plot_observation_diagnostics()
   
   Functions:
   â€¢ Load observation data from CSV
   â€¢ Quality checking and validation
   â€¢ Outlier detection and removal
   â€¢ Weighting strategies
   â€¢ Diagnostic plots

ğŸ¯ INTEGRATION & EXAMPLES
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

7. optimize_soil_parameters.py (INTEGRATION TEMPLATE)
   â”œâ”€ build_simulation_with_params() - wrapper function
   â”œâ”€ create_synthetic_observations() - for testing
   â”œâ”€ Integration example with your simulation
   â””â”€ Complete workflow demonstration
   
   THIS IS YOUR STARTING POINT for integration!
   Shows exactly how to connect the optimizer to your existing code.

8. complete_example.py (END-TO-END WORKFLOW)
   â”œâ”€ compare_materials() - soil type database
   â”œâ”€ create_bounds_from_soil_type()
   â”œâ”€ multi_start_optimization()
   â”œâ”€ parameter_sensitivity_plot()
   â”œâ”€ create_comprehensive_report()
   â””â”€ Complete workflow from data to results
   
   Features:
   â€¢ Database of typical soil parameters
   â€¢ Multi-start optimization (avoid local minima)
   â€¢ Sensitivity analysis
   â€¢ Comprehensive reporting
   â€¢ Production-ready workflow

9. soil_parameter_optimization.py (LEGACY/REFERENCE)
   â”œâ”€ Initial van Genuchten model implementation
   â”œâ”€ Pure PyTorch approach (no Firedrake integration)
   â””â”€ Reference implementation

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“‹ QUICK REFERENCE: WHICH FILE DO I NEED?
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

TASK                                          FILE TO USE
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Getting started                               QUICKSTART.md
Understanding the system                      ARCHITECTURE.txt
Detailed documentation                        README.md
Load observation data                         data_preparation.py
Basic optimization (< 5 params)              parameter_optimizer.py
Advanced optimization (> 5 params)           adjoint_optimizer.py
Integration with your simulation              optimize_soil_parameters.py
Complete workflow example                     complete_example.py
Uncertainty quantification                    adjoint_optimizer.py
Multi-start optimization                      complete_example.py
Sensitivity analysis                          adjoint_optimizer.py

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸš€ RECOMMENDED WORKFLOW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. READ QUICKSTART.md
   â””â”€ Understand basic concepts and quick start

2. PREPARE YOUR DATA (data_preparation.py)
   â””â”€ Load and quality-check your water level observations

3. MODIFY optimize_soil_parameters.py
   â””â”€ Adapt build_simulation_with_params() to your code

4. TEST WITH SYNTHETIC DATA
   â””â”€ Run optimize_soil_parameters.py with synthetic observations

5. RUN WITH REAL DATA
   â””â”€ Use your actual observations

6. ANALYZE RESULTS (complete_example.py)
   â””â”€ Multi-start, sensitivity, uncertainty analysis

7. FOR PRODUCTION
   â””â”€ Switch to adjoint_optimizer.py for efficiency

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”§ CUSTOMIZATION POINTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

To integrate with YOUR simulation, you need to:

1. Modify build_simulation_with_params()
   Location: optimize_soil_parameters.py
   Task: Connect to your RichardsSolver

2. Ensure your Material class accepts parameters
   Required: Material(theta_r, theta_s, alpha, n, Ks)

3. ProbeManager must support
   Required: probe_manager.get_value_at(time, x, y)
   (or adapt the optimizer's extract logic)

4. Set realistic parameter bounds
   Use: complete_example.compare_materials()
   Based on your soil type

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š EXPECTED OUTPUTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”€â”€â”€â”€â•â•â•â•â•â•â•â•â•â•â•â•

After running optimization, you'll get:

1. Plots:
   â”œâ”€ optimization_convergence.png (loss vs iteration)
   â”œâ”€ parameter_evolution.png (how params changed)
   â”œâ”€ observed_vs_simulated.png (fit quality)
   â””â”€ residuals.png (errors)

2. Text Reports:
   â”œâ”€ optimization_report.txt (summary statistics)
   â””â”€ Console output (iteration progress)

3. Optimized Parameters:
   â””â”€ Dictionary with best-fit van Genuchten parameters

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš¡ PERFORMANCE NOTES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Finite Differences:
â€¢ Speed: ~30 sec/iteration (5 params, 1-month sim)
â€¢ Total time: ~25 minutes (50 iterations)
â€¢ Memory: Low
â€¢ Best for: Quick tests, < 5 parameters

Adjoint Method:
â€¢ Speed: ~10 sec/iteration (5 params, 1-month sim)
â€¢ Total time: ~8 minutes (50 iterations)
â€¢ Memory: Moderate
â€¢ Best for: Production, > 5 parameters

Speedup: 3-5x (increases with more parameters)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ†˜ COMMON ISSUES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Issue: "ModuleNotFoundError: No module named 'src'"
Fix: Adjust import paths to match your project structure

Issue: Optimization diverges
Fix: Reduce learning rate, check parameter bounds

Issue: Parameters hit bounds
Fix: Widen bounds or add constraints

Issue: Very slow convergence
Fix: Use better initial guess or switch to adjoint method

Issue: "get_value_at not found"
Fix: Adapt probe extraction logic to your ProbeManager API

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“š DEPENDENCIES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”€â”€â”€â”€â•â•â•â•â”€â”€â”€â”€â”€â”€â”€â”€â•â•â•â•â•â•â•â•

Required:
â€¢ torch (PyTorch)
â€¢ numpy
â€¢ pandas
â€¢ matplotlib
â€¢ scipy
â€¢ firedrake (your existing installation)
â€¢ firedrake-adjoint (pyadjoint) - for adjoint method only

Your existing:
â€¢ src module (with RichardsSolver, Domain, Material, etc.)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âœ¨ KEY FEATURES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Automatic bound constraints (parameters always physically reasonable)
âœ“ Multiple optimization algorithms (Adam, L-BFGS-B, SGD)
âœ“ Two gradient methods (finite differences or adjoint)
âœ“ Comprehensive diagnostics and visualization
âœ“ Multi-start optimization to avoid local minima
âœ“ Sensitivity and uncertainty analysis
âœ“ Flexible observation weighting
âœ“ Quality checking and outlier detection
âœ“ Extensible framework for custom objectives

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ REFERENCES & FURTHER READING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Van Genuchten Parameters:
â€¢ Carsel, R. F., & Parrish, R. S. (1988). Developing joint probability 
  distributions of soil water retention characteristics. Water Resources
  Research, 24(5), 755-769.

Inverse Modeling:
â€¢ Vrugt, J. A., et al. (2008). Inverse modeling of subsurface flow and
  transport properties: A review with new developments. Vadose Zone Journal.

Adjoint Methods:
â€¢ Plessix, R. E. (2006). A review of the adjoint-state method for computing
  the gradient of a functional with geophysical applications.

Tools:
â€¢ PyTorch: https://pytorch.org/
â€¢ Firedrake: https://www.firedrakeproject.org/
â€¢ pyadjoint: http://www.dolfin-adjoint.org/

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Need help? Check the QUICKSTART.md and README.md for detailed guidance!

Good luck with your parameter optimization! ğŸ‰

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•